<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>270 : Natural convection · ExtendableFEM.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ExtendableFEM.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../package_index/">Index</a></li><li><span class="tocitem">Problem Description</span><ul><li><a class="tocitem" href="../../problemdescription/">Problem Description</a></li><li><a class="tocitem" href="../../nonlinearoperator/">NonlinearOperator</a></li><li><a class="tocitem" href="../../bilinearoperator/">BilinearOperator</a></li><li><a class="tocitem" href="../../linearoperator/">LinearOperator</a></li><li><a class="tocitem" href="../../interpolateboundarydata/">InterpolateBoundaryData</a></li><li><a class="tocitem" href="../../homogeneousdata/">HomogeneousData</a></li><li><a class="tocitem" href="../../fixdofs/">FixDofs</a></li><li><a class="tocitem" href="../../combinedofs/">CombineDofs</a></li><li><a class="tocitem" href="../../callbackoperator/">CallbackOperator</a></li></ul></li><li><span class="tocitem">Solving</span><ul><li><a class="tocitem" href="../../pdesolvers/">Stationary Solvers</a></li><li><a class="tocitem" href="../../pdesolvers_dt/">Time-dependent Solvers</a></li></ul></li><li><span class="tocitem">Postprocessing</span><ul><li><a class="tocitem" href="../../postprocessing/">Other packages</a></li><li><a class="tocitem" href="../../itemintegrators/">Item Integrators</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples_intro/">About the examples</a></li><li><a class="tocitem" href="../Example103_BurgersEquation/">103 : Burger&#39;s Equation</a></li><li><a class="tocitem" href="../Example105_NonlinearPoissonEquation/">105 : Nonlinear Poisson Equation</a></li><li><a class="tocitem" href="../Example106_NonlinearDiffusion/">106 : Nonlinear Diffusion</a></li><li><a class="tocitem" href="../Example108_RobinBoundaryCondition/">108 : Robin Boundary Condition</a></li><li><a class="tocitem" href="../Example201_PoissonProblem/">201 : Poisson-Problem</a></li><li><a class="tocitem" href="../Example202_MixedPoissonProblem/">202 : Poisson-Problem (Mixed)</a></li><li><a class="tocitem" href="../Example205_HeatEquation/">205 : Heat equation</a></li><li><a class="tocitem" href="../Example210_LshapeAdaptivePoissonProblem/">210 : Poisson L-shape Adaptive Mesh Refinement</a></li><li><a class="tocitem" href="../Example211_LshapeAdaptiveEQPoissonProblem/">211 : Poisson L-shape Local Equilibrated Fluxes</a></li><li><a class="tocitem" href="../Example220_ReactionConvectionDiffusion/">220 : Reaction-Convection-Diffusion-Problem</a></li><li><a class="tocitem" href="../Example225_ObstacleProblem/">225 : Obstacle Problem</a></li><li><a class="tocitem" href="../Example230_NonlinearElasticity/">230 : Nonlinear Elasticity</a></li><li><a class="tocitem" href="../Example235_StokesIteratedPenalty/">235 : Stokes iterated penalty method</a></li><li><a class="tocitem" href="../Example240_SVRTEnrichment/">240 : Stokes <span>$RT$</span> enrichment</a></li><li><a class="tocitem" href="../Example245_NSEFlowAroundCylinder/">245 : Flow around a cylinder</a></li><li><a class="tocitem" href="../Example250_NSELidDrivenCavity/">250 : Navier–Stokes Lid-driven cavity</a></li><li><a class="tocitem" href="../Example252_NSEPlanarLatticeFlow/">252 : Navier–Stokes Planar Lattice Flow</a></li><li><a class="tocitem" href="../Example260_AxisymmetricNavierStokesProblem/">260 : Axisymmetric Stokes</a></li><li><a class="tocitem" href="../Example265_FlowTransport/">265 : Flow + Transport</a></li><li class="is-active"><a class="tocitem" href>270 : Natural convection</a></li><li><a class="tocitem" href="../Example280_CompressibleStokes/">240 : Compressible Stokes 2D</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>270 : Natural convection</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>270 : Natural convection</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="github.com/chmerdon/ExtendableFEM.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id=":-Natural-convection"><a class="docs-heading-anchor" href="#:-Natural-convection">270 : Natural convection</a><a id=":-Natural-convection-1"></a><a class="docs-heading-anchor-permalink" href="#:-Natural-convection" title="Permalink"></a></h1><p>(<a href="https://github.com/chmerdon/ExtendableFEM.jl/raw/master/examples/Example270_NaturalConvectionProblem.jl">source code</a>)</p><p>Seek velocity <span>$u$</span>, pressure <span>$p$</span> and temperature <span>$\theta$</span> such that</p><p class="math-container">\[\begin{aligned}
	- \mu \Delta u + (u \cdot \nabla) u + \nabla p &amp; = Ra \, \theta \, g \\
       - \Delta \theta + u \cdot \nabla \theta &amp; = 0
\end{aligned}\]</p><p>on a given domain <span>$\Omega$</span> (here a triangle) and boundary conditions</p><p class="math-container">\[\begin{aligned}
	u &amp; = 0 &amp;&amp; \quad \text{along } \partial \Omega\\
 	T &amp; = T_\text{bottom} &amp;&amp;\quad \text{along } y = 0\\
	T &amp; = 0 &amp;&amp;\quad \text{along } x = 0
\end{aligned}\]</p><p>The weak formulation seeks <span>$(u,p,\theta) \in V \times Q \times X \subseteq H^1_0(\Omega)^2 \times L^2_0(\Omega) \times H^1_D(\Omega)$</span> such that</p><p class="math-container">\[\begin{aligned}
	(\mu \nabla u, \nabla v) + ((u \cdot \nabla) u, v) - (\mathrm{div} v, p) &amp; = (v, Ra g \, \theta) &amp;&amp; \quad \text{for all } v \in V,\\
(\mathrm{div} u, q) &amp; = 0 &amp;&amp; \quad \text{for all } q \in Q,\\
       (\nabla \theta, \nabla \varphi) + (u \cdot \nabla \theta, \varphi) &amp; = 0
 &amp;&amp; \quad \text{for all } \varphi \in X.
\end{aligned}\]</p><p>To render the discrete method pressure-robust, a reconstruction operator is applied to all identity evaluations of <span>$u$</span> and <span>$v$</span> (when the switch reconstruct is set to true). Further explanations and discussion on this example can be found in the reference below.</p><div class="admonition is-category-reference"><header class="admonition-header">Reference</header><div class="admonition-body"><p>&quot;On the divergence constraint in mixed finite element methods for incompressible flows&quot;,<br/>V. John, A. Linke, C. Merdon, M. Neilan and L. Rebholz,<br/>SIAM Review 59(3) (2017),<br/><a href="https://doi.org/10.1137/15M1047696">&gt;Journal-Link&lt;</a> <a href="http://www.wias-berlin.de/publications/wias-publ/run.jsp?template=abstract&amp;type=Preprint&amp;year=2015&amp;number=2177">&gt;Preprint-Link&lt;</a></p></div></div><pre><code class="language-julia hljs">module Example270_NaturalConvectionProblem

using ExtendableFEM
using ExtendableFEMBase
using GridVisualize
using ExtendableGrids

function kernel_nonlinear!(result, u_ops, qpinfo)
    u, ∇u, p, ∇T, T = view(u_ops, 1:2), view(u_ops,3:6), view(u_ops, 7), view(u_ops, 8:9), view(u_ops, 10)
    Ra, μ, ϵ = qpinfo.params[1], qpinfo.params[2], qpinfo.params[3]
    result[1] = dot(u, view(∇u,1:2))
    result[2] = dot(u, view(∇u,3:4)) - Ra*T[1]
    result[3] = μ*∇u[1] - p[1]
    result[4] = μ*∇u[2]
    result[5] = μ*∇u[3]
    result[6] = μ*∇u[4] - p[1]
    result[7] = -(∇u[1] + ∇u[4])
    result[8] = ϵ*∇T[1]
    result[9] = ϵ*∇T[2]
    result[10] = dot(u, ∇T)
    return nothing
end

function T_bottom!(result, qpinfo)
    x = qpinfo.x
    result[1] = 2*(1-cos(2*π*x[1]))
end

function main(;
    nrefs = 5,
    μ = 1.0,
    ϵ = 1.0,
    Ra_final = 1.0e6,
    reconstruct = true,
    Plotter = nothing,
    kwargs...)

    # problem description
    PD = ProblemDescription()
    u = Unknown(&quot;u&quot;; name = &quot;velocity&quot;)
    p = Unknown(&quot;p&quot;; name = &quot;pressure&quot;)
    T = Unknown(&quot;T&quot;; name = &quot;temperature&quot;)
    assign_unknown!(PD, u)
    assign_unknown!(PD, p)
    assign_unknown!(PD, T)
    id_u = reconstruct ? apply(u, Reconstruct{HDIVBDM1{2}, Identity}) : id(u)
    assign_operator!(PD, NonlinearOperator(kernel_nonlinear!, [id_u,grad(u),id(p),grad(T),id(T)]; kwargs...))
    assign_operator!(PD, HomogeneousBoundaryData(u; regions = 1:3))
    assign_operator!(PD, FixDofs(p; dofs = [1], vals = [0]))
    assign_operator!(PD, HomogeneousBoundaryData(T; regions = 3))
    assign_operator!(PD, InterpolateBoundaryData(T, T_bottom!; regions = 1))

    # grid
    xgrid = uniform_refine(reference_domain(Triangle2D), nrefs)

    # FESpaces
    FES = Dict(u =&gt; FESpace{H1BR{2}}(xgrid),
               p =&gt; FESpace{L2P0{1}}(xgrid),
               T =&gt; FESpace{H1P1{1}}(xgrid))

    # prepare plots
    plt = GridVisualizer(; Plotter = Plotter, layout = (1,3), clear = true, size = (1200,400))

    # solve by Ra embedding
	params = Array{Float64,1}([min(Ra_final, 4000), μ, ϵ])
    sol = nothing
    SC = nothing
	step = 0
	while (true)
        # solve (params are given to all operators)
        sol, SC = ExtendableFEM.solve(PD, FES, SC; init = sol, return_config = true, target_residual = 1e-6, params = params, kwargs...)

        # plot
        scalarplot!(plt[1,1], xgrid, view(nodevalues(sol[u]; abs = true),1,:), levels = 0, colorbarticks = 7)
        vectorplot!(plt[1,1], xgrid, eval_func(PointEvaluator([id(u)], sol)), clear = false, title = &quot;|u| + quiver (Ra = $(params[1]))&quot;)
        scalarplot!(plt[1,2], xgrid, view(nodevalues(sol[T]),1,:), title = &quot;T (Ra = $(params[1]))&quot;)
        scalarplot!(plt[1,3], xgrid, view(nodevalues(sol[p]),1,:), title = &quot;p (Ra = $(params[1]))&quot;)

        # stop if Ra_final is reached
		if params[1] &gt;= Ra_final
			break
		end

        # increase Ra
		params[1] = min(Ra_final, params[1]*3)
		step += 1
		@info &quot;Step $step : solving for Ra=$(params[1])&quot;
	end

    # compute Nusselt number
    ∇T_faces = FaceInterpolator([jump(grad(T))]; order = 0, kwargs...)
	NuIntegrator = ItemIntegrator((result, input, qpinfo) -&gt; (result[1] = -input[2]), [id(1)]; entities = ON_FACES, regions = [1])
	@info &quot;Nu = $(sum(evaluate(NuIntegrator, evaluate!(∇T_faces, sol))))&quot;

    return sol
end

end # module</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p><p><strong>Default output:</strong></p><pre><code class="nohighlight hljs">julia&gt; Example270_NaturalConvectionProblem.main()
 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.23
   1	2.317e+01	3.077e-11	0.19	0.08	0.27		4.10	15.67	19.77
   2	1.507e+01	8.579e-11	0.20	0.04	0.24		3.16	17.20	20.36
   3	1.814e+00	3.405e-11	0.20	0.06	0.26		0.15	13.14	13.30
   4	1.312e-01	2.541e-11	0.20	0.03	0.22		0.15	13.14	13.30
   5	4.601e-04	2.326e-11	0.20	0.03	0.22		0.15	13.14	13.30
 END	2.207e-09			0.20		0.20		0.15		0.15
	converged				SUM --&gt;	1.41			SUM --&gt;	80.41

 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.00
   1	3.965e+02	8.919e-10	0.20	0.03	0.23		0.16	13.14	13.30
   2	4.226e+01	1.698e-10	0.20	0.06	0.26		0.16	13.14	13.30
   3	4.205e+00	3.669e-09	0.20	0.03	0.23		0.16	13.14	13.30
   4	6.763e-02	6.935e-09	0.20	0.03	0.23		0.16	13.14	13.30
   5	2.126e-05	8.792e-09	0.20	0.03	0.23		0.16	13.14	13.30
 END	8.792e-09			0.20		0.20		0.16		0.16
	converged				SUM --&gt;	1.36			SUM --&gt;	66.65

 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.00
   1	1.182e+03	2.625e-10	0.20	0.04	0.24		0.16	13.14	13.30
   2	1.188e+02	7.779e-09	0.20	0.03	0.23		0.16	13.14	13.30
   3	2.150e+01	1.135e-09	0.20	0.03	0.23		0.16	13.14	13.30
   4	1.019e+00	1.697e-09	0.20	0.03	0.23		0.16	13.14	13.30
   5	2.696e-03	2.896e-09	0.20	0.04	0.24		0.16	13.14	13.30
 END	1.149e-08			0.20		0.20		0.16		0.16
	converged				SUM --&gt;	1.35			SUM --&gt;	66.65

 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.00
   1	3.431e+03	9.538e-09	0.20	0.03	0.23		0.16	13.14	13.30
   2	4.403e+02	1.529e-09	0.20	0.03	0.23		0.16	13.14	13.30
   3	1.091e+02	3.165e-09	0.20	0.03	0.23		0.16	13.14	13.30
   4	1.104e+01	1.531e-08	0.20	0.04	0.24		0.16	13.14	13.30
   5	1.319e-01	2.166e-08	0.20	0.03	0.23		0.16	13.14	13.30
   6	1.327e-05	5.323e-09	0.20	0.03	0.23		0.16	13.14	13.30
 END	5.323e-09			0.20		0.20		0.16		0.16
	converged				SUM --&gt;	1.57			SUM --&gt;	79.95

 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.00
   1	9.821e+03	8.066e-10	0.20	0.03	0.23		0.16	13.14	13.30
   2	2.159e+03	1.763e-09	0.20	0.04	0.24		0.16	13.14	13.30
   3	5.758e+02	5.365e-09	0.20	0.03	0.23		0.16	13.14	13.30
   4	1.364e+02	5.969e-09	0.20	0.03	0.23		0.16	13.14	13.30
   5	1.020e+01	1.694e-09	0.20	0.03	0.23		0.16	13.14	13.30
   6	1.191e-02	2.227e-09	0.20	0.04	0.24		0.16	13.14	13.30
 END	2.944e-07			0.20		0.20		0.16		0.16
	converged				SUM --&gt;	1.58			SUM --&gt;	79.95

 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.00
   1	2.761e+04	2.237e-09	0.20	0.03	0.23		0.16	15.49	15.65
   2	1.388e+04	2.887e-09	0.20	0.03	0.23		0.16	15.58	15.73
   3	4.992e+03	2.568e-09	0.20	0.04	0.24		0.16	15.54	15.69
   4	2.276e+03	1.722e-08	0.20	0.03	0.23		0.16	15.60	15.75
   5	8.979e+02	2.989e-09	0.20	0.03	0.23		0.16	15.49	15.64
   6	1.208e+02	2.505e-09	0.20	0.04	0.24		0.16	15.59	15.74
   7	1.574e+01	5.427e-09	0.20	0.03	0.23		0.16	15.61	15.77
   8	6.250e-02	3.891e-09	0.20	0.03	0.23		0.16	15.61	15.77
   9	7.218e-06	5.026e-09	0.20	0.04	0.24		0.16	15.61	15.77
 END	5.071e-09			0.20		0.20		0.16		0.16
	converged				SUM --&gt;	2.30			SUM --&gt;	141.67

 #IT	------- RESIDUALS -------	---- DURATION (s) ----		---- ALLOCATIONS (MiB) ----
   	NONLINEAR	LINEAR		ASSEMB	SOLVE	TOTAL		ASSEMB	SOLVE	TOTAL
 INI							0.00				0.00
   1	1.101e+03	3.819e-09	0.20	0.03	0.23		0.16	15.58	15.73
   2	2.032e+00	3.302e-09	0.20	0.03	0.23		0.16	15.62	15.77
   3	1.311e-03	5.047e-09	0.20	0.04	0.24		0.16	15.62	15.77
 END	5.059e-09			0.20		0.20		0.16		0.16
	converged				SUM --&gt;	0.89			SUM --&gt;	47.44
</code></pre><p><img src="../../images/Example270_NaturalConvectionProblem_1.png" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Example265_FlowTransport/">« 265 : Flow + Transport</a><a class="docs-footer-nextpage" href="../Example280_CompressibleStokes/">240 : Compressible Stokes 2D »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Tuesday 5 September 2023 12:32">Tuesday 5 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
